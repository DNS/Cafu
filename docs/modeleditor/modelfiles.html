
<h1 class="sectionedit1" id="model_files_explained">Model Files Explained</h1>
<div class="level1">

<p>
Each model comprises several files on disk, such as the model file, material definition files, and texture images.
</p>

<p>
When you save a model in the Model Editor, the editor creates or re-creates some of these files, updates others, and leaves alone the rest.
The result is normally exactly what you want and expect, but sometimes you may wish to hand-tune some details (such as the material definitions) without and independently of the Model Editor. In such cases, it is very helpful to understand the files that belong to a model.
</p>

<p>
This section explains the files that together form a model and how they relate to each other.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Model Files Explained&quot;,&quot;hid&quot;:&quot;model_files_explained&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-664&quot;} -->
<h2 class="sectionedit2">One directory per model</h2>
<div class="level2">

<p>
Although not a technical requirement and not enforced by the Cafu model code, it is highly recommended to save each model in a directory of its own. This
</p>
<ul>
<li class="level1"><div class="li"> explicitly groups all files that logically form and belong to the model, and</div>
</li>
<li class="level1"><div class="li"> makes packaging a complete model in a <code>my_model.zip</code> archive possible, so that the model can easily and safely be distributed, shipped and handled.</div>
</li>
</ul>

<p>
The name of the directory should match the file name of the model. That is, if your model&#039;s name is <code>Trinity.cmdl</code>, it should be stored in a directory with the same name <code>Trinity/</code> (or in a zip archive with the same base name <code>Trinity.zip</code>).
</p>

<p>
Note that when you are saving a new model that does not yet have a separate directory, you can use the “New Folder” button (or right-click context menu) of the “Save” dialog to create such new directories as required.
</p>

<p>
Example:
</p>
<pre class="code dos">d:\Dev\Cafu\Games\DeathMatch\Models\Players<span class="sy0">&gt;</span> <a href="http://www.ss64.com/nt/dir.html"><span class="kw3">dir</span></a> Trinity
ChromeBuckle_diff.png
ChromeGlass_diff.png
Pants_diff.png
Skin_diff.png
Trinity.cmat
Trinity.cmdl
Trinity.cmdl_bak
Trinity_editor.cmat</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;One directory per model&quot;,&quot;hid&quot;:&quot;one_directory_per_model&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;665-1782&quot;} -->
<h2 class="sectionedit3" id="cmdl_model_files">cmdl model files</h2>
<div class="level2">

<p>
The <code>cmdl</code> file is the main file of the model: It contains the definitions for the skeleton, the meshes and the animation sequences of the model.
</p>

<p>
The Cafu Engine and the Model Editor load <code>cmdl</code> files as <a href="http://www.lua.org/" class="urlextern" title="http://www.lua.org/" rel="nofollow">Lua</a> scripts, and as such they can be inspected or edited in a text editor if desired.
</p>

<p>
Besides the main <code>cmdl</code> file, the Model Editor also creates a <code>cmdl_bak</code> backup file that contains the contents of the <code>cmdl</code> file before it was last saved. (If you ship your model as a <code>zip</code> archive, the <code>cmdl_bak</code> file is typically redundant and can be omitted from the archive for space efficiency.)
</p>

<p>
Example:
</p>
<pre class="code dos">d:\Dev\Cafu\Games\DeathMatch\Models\Players<span class="sy0">&gt;</span> <a href="http://www.ss64.com/nt/dir.html"><span class="kw3">dir</span></a> Trinity\*.cmdl*
Trinity.cmdl
Trinity.cmdl_bak</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;cmdl model files&quot;,&quot;hid&quot;:&quot;cmdl_model_files&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:3,&quot;range&quot;:&quot;1783-2571&quot;} -->
<h2 class="sectionedit4">cmat material definition files</h2>
<div class="level2">

<p>
The <code><abbr title="Cafu material script file.">cmat</abbr></code> files contain the material definitions for the meshes of this model.
</p>

<p>
The main <code><abbr title="Cafu material script file.">cmat</abbr></code> file must have the same base name as the model (“Trinity”), so that the full name is for example <code>Trinity.<abbr title="Cafu material script file.">cmat</abbr></code>. This file is for your hand-written material script code, if any, and is never touched or overwritten by the Model Editor (with one exception, see below).
</p>

<p>
The Model Editor also writes a secondary <code><abbr title="Cafu material script file.">cmat</abbr></code> file whose name ends with <code>_editor.<abbr title="Cafu material script file.">cmat</abbr></code>. This file is written anew each time the model is saved, and contains material definitions whose script code was not hand-crafted, but who were created or edited in the Model Editor.
</p>

<p>
Example:
</p>
<pre class="code dos">d:\Dev\Cafu\Games\DeathMatch\Models\Players<span class="sy0">&gt;</span> <a href="http://www.ss64.com/nt/dir.html"><span class="kw3">dir</span></a> Trinity\*.cmat
Trinity.cmat
Trinity_editor.cmat</pre>

<p>
The two <code><abbr title="Cafu material script file.">cmat</abbr></code> files are linked as follows:
When the Cafu model code loads the materials of a model, it opens the main <code><abbr title="Cafu material script file.">cmat</abbr></code> file (<code>Trinity.<abbr title="Cafu material script file.">cmat</abbr></code>). This file contains a statement like
</p>
<pre class="code lua"><span class="kw3">dofile</span><span class="br0">&#40;</span><span class="st0">&quot;Trinity_editor.cmat&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
in order to include and process the secondary <code>_editor.<abbr title="Cafu material script file.">cmat</abbr></code> along with the main file.
</p>

<p>
The only exception when the Model Editor touches the main <code>Trinity.<abbr title="Cafu material script file.">cmat</abbr></code> file is when the file does not yet exist, or doesn&#039;t contain the <code>dofile()</code> reference to the editor file. In this case, the <code>_editor.<abbr title="Cafu material script file.">cmat</abbr></code> would not be loaded at all, and thus the Model Editor inserts the <code>dofile()</code> line into the main <code><abbr title="Cafu material script file.">cmat</abbr></code> file.
</p>

<p>
In summary, the goal of keeping two separate <code><abbr title="Cafu material script file.">cmat</abbr></code> files that are linked as described above is to keep your hand-crafted material script code and the Model Editor edited material definitions cleanly separated, without any danger of one overwriting the other.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;cmat material definition files&quot;,&quot;hid&quot;:&quot;cmat_material_definition_files&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:4,&quot;range&quot;:&quot;2572-4316&quot;} -->
<h2 class="sectionedit5">Texture images</h2>
<div class="level2">

<p>
The texture images are referenced from the material definition scripts.
See the documentation about <a href="http://docs.cafu.de/#the_cafu_material_system" class="urlextern" title="http://docs.cafu.de/#the_cafu_material_system" rel="nofollow">the Cafu Material System</a> for more details.
</p>

<p>
Example:
</p>
<pre class="code dos">d:\Dev\Cafu\Games\DeathMatch\Models\Players<span class="sy0">&gt;</span> <a href="http://www.ss64.com/nt/dir.html"><span class="kw3">dir</span></a> Trinity\*.png Trinity\*.jpg
ChromeBuckle_diff.png
ChromeGlass_diff.png
Pants_diff.png
Skin_diff.png</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Texture images&quot;,&quot;hid&quot;:&quot;texture_images&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:5,&quot;range&quot;:&quot;4317-&quot;} -->