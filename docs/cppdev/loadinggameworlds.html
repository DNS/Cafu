
<h1 class="sectionedit1" id="loading_game_worlds">Loading game worlds</h1>
<div class="level1">

<p>
While we have introduced the <abbr title="Graphical User Interface">GUI</abbr> and entity component systems at several occasions:
</p>
<ol>
<li class="level1"><div class="li"> todo</div>
</li>
</ol>

<p>
this document provides an overview of how the Cafu programs actually instantiate a game world that is composed of game entities.
</p>

<p>
All Cafu programs can load game worlds, i.e. the game server, client, the world editor <abbr title="Cafu World Editor">CaWE</abbr> and the compile tools.
We will use the server&#039;s code for reference, but as the code is similar in all programs, we will cover the specifics of other programs as well.
</p>

<p>
Also use the class diagram in <code>Ca3DE/ClassDiagram.dia</code> besides this text for reference.
</p>

<p>
The server loads a game world by creating a <code>CaServerWorldT</code> instance which derives from <code>Ca3DEWorldT</code>.
</p>

<p>
The <code>Ca3DEWorldT</code>&#039;s <code>const WorldT* m_World</code> member contains the data from the BSP, PVS and Radiosity compile process: for each static entity, it has the BSP tree, a collision model, lightmaps, etc. ( <img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" /> not only static, but in fact for <em>all</em> entities in the <abbr title="Cafu Map File. Create them with CaWE, turn them into cw files with CaBSP.">cmap</abbr>? )
This data is later correlated to (and becomes a component of) the main entity instances <code>cf::GameSys::EntityT</code>.
</p>

<p>
The <code>Ca3DEWorldT</code> keeps an instance of a <code>cf::UniScriptStateT</code>. This script state is a Lua instance to which later our objects are bound so that we then can write code such as:
</p>
<pre class="code lua"><span class="kw1">local</span> new_ent <span class="sy0">=</span> world<span class="sy0">:</span>new<span class="br0">&#40;</span><span class="st0">&quot;EntityT&quot;</span><span class="sy0">,</span> <span class="st0">&quot;left_wing&quot;</span><span class="br0">&#41;</span>
Door<span class="sy0">:</span>AddChild<span class="br0">&#40;</span>new_ent<span class="br0">&#41;</span>
new_ent<span class="sy0">:</span>GetTransform<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span>set<span class="br0">&#40;</span><span class="st0">&quot;Origin&quot;</span><span class="sy0">,</span> <span class="nu0">480</span><span class="sy0">,</span> <span class="sy0">-</span><span class="nu0">352</span><span class="sy0">,</span> <span class="nu0">104</span><span class="br0">&#41;</span></pre>

<p>
Note that <em>both</em> game entities <em>and</em> <abbr title="Graphical User Interface">GUI</abbr> windows, our two sibling component systems, can be instantiated in the script state  of a <code>Ca3DEWorldT</code>.
</p>

</div>
