
<h1 class="sectionedit1" id="about_lights_and_shadows">About Lights and Shadows</h1>
<div class="level1">

<p>
<img src="/lib/images/smileys/fixme.gif" class="icon" alt="FIXME" />  This page is still under construction <img src="/lib/images/smileys/icon_exclaim.gif" class="icon" alt=":!:" />
</p>

<p>
One of the key questions that mappers frequently raise is how to define and place light sources.
While placing light sources is generally easy, this section explains the types of available lighting techniques in Cafu and the options to create light sources for each.
</p>

<p>
The Cafu engine implements two different types of lighting techniques:
</p>
<ul>
<li class="level1"><div class="li"> Radiosity-based lighting and</div>
</li>
<li class="level1"><div class="li"> dynamic lighting.</div>
</li>
</ul>

<p>
The two lighting techniques are quite distinct from each other, and each comes with a set of feature of its own. Nonetheless, both techniques peacefully coexist in the Cafu engine and mappers frequently employ both in a single map.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;About Lights and Shadows&quot;,&quot;hid&quot;:&quot;about_lights_and_shadows&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-720&quot;} -->
<h2 class="sectionedit2">Radiosity-based Lighting</h2>
<div class="level2">

<p>
One of the most fundamental lighting techniques in computer graphics is the <a href="https://en.wikipedia.org/wiki/Radiosity" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Radiosity">Radiosity</a> method.
Radiosity methods compute lighting based on a physical model, and it is the nature of the underlying mathematics that characterizes the features of the technique.
</p>

<p>
The big downside of Radiosity is that it requires a preprocessing step. This preprocessing step can be computationally very expensive and thus take a long time to complete. It is implemented in a special tool called “<abbr title="Cafu Radiosity Lighting">CaLight</abbr>”, which is one of the map compilers that are covered in sections <a href="/mapping:compiling_new#compiling_maps_for_cafu" class="wikilink1" title="mapping:compiling_new">Compiling Maps for Cafu</a> and <a href="/mapping:compiling#compiling_maps_at_the_command-line" class="wikilink1" title="mapping:compiling">Compiling Maps at the Command-Line</a>.
</p>

<p>
The fact that Radiosity is slow to precompute also means that it cannot work with dynamic objects: Radiosity takes walls and any other static object into account, but anything that moves will not influence the Radiosity-based lighting result.
</p>

<p>
Good news about Radiosity-based lighting is that once the preprocessing step it complete, it is <em>fast</em>. Independently of the number of light sources or complexity of the scene, Radiosity-based lighting provides very good performance at run-time during the game. It is therefore a natural choice for large-scale base lighting of any level.
</p>

<p>
Even better, Radiosity lighting results looks stunningly good. No matter what hardware vendors tell you about their latest products, no matter what game developers tell you about dynamic lighting (as I do, too; see below), none of these techniques can beat the realism of lighting generated by Radiosity methods. Based on an accurate physical model, the natural propagation and appearance of lights and shadows is unique to Radiosity methods.
</p>

<p>
The Radiosity method also handles <em>area light sources</em> without special measures, but as a natural part of the algorithm. Area light sources are an important key feature, because they are the main contributors to a realistic lights and shadows distribution with diffuse reflections and soft shadows.
This is contrary to dynamic lighting, where lights are only points in space, soft shadows are always the result of some kind of trick, diffuse reflections are not possible at all, and a physical model is never involved.
</p>

<p>
For these reasons, Radiosity was the first lighting technique implemented in Cafu.
</p>

<p>
Here is an overview of the available Radiosity light sources and how they are created in a map:
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Radiosity-based Lighting&quot;,&quot;hid&quot;:&quot;radiosity-based_lighting&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;721-3101&quot;} -->
<h3 class="sectionedit3">Area Light Sources</h3>
<div class="level3">

<p>
Any primitive (brush or Bezier patch) surface that you place in a Cafu map can be turned into an <em>area light source</em>. The key point here is that a surfaces characteristic of being an area light source is <em>not</em> <img src="/lib/images/smileys/icon_exclaim.gif" class="icon" alt=":!:" /> directly set in the Cafu World Editor <abbr title="Cafu World Editor">CaWE</abbr>. Rather, being an area light source is a <em>material</em> property.
That means that a surface becomes an area light source when it has a material applied to it which in turn is defined to emit Radiosity light.
</p>
<ul>
<li class="level1"><div class="li"> In order to place an area light source, use the <a href="/mapping:cawe:editingtools:editfaceprops#the_edit_surface_properties_tool" class="wikilink1" title="mapping:cawe:editingtools:editfaceprops">Edit Surfaces</a> tool to apply an appropriately defined material to the desired brush or Bezier patch surface. You can learn which materials cast Radiosity area light by clicking on them once in the <a href="/mapping:cawe:materialbrowser#the_material_browser" class="wikilink1" title="mapping:cawe:materialbrowser">Material Browser</a>. The bar at the bottom will show “Radiant Exitance” information on the selected material, if any.<br/>
Tip: Filter for materials with the string “light” in their name. This heightens the chance to find a relevant material quickly.</div>
</li>
<li class="level1"><div class="li"> In order to change the definition of a new or existing material to emit light, make sure that the <code>meta_radiantExitance</code> keyword is employed. Please refer to the Material Systems <a href="/matsys:cmat_manual:keywordreference#keyword_reference" class="wikilink1" title="matsys:cmat_manual:keywordreference">Keyword Reference</a> for more details.<br/>
Note that the effect of changing the definition of an <em>existing</em> material is <em>global</em>. That is, if the material is used elsewhere (in another map), also the other map will be affected when <abbr title="Cafu Radiosity Lighting">CaLight</abbr> is run next.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Area Light Sources&quot;,&quot;hid&quot;:&quot;area_light_sources&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;3102-4629&quot;} -->
<h3 class="sectionedit4">Point light sources</h3>
<div class="level3">

<p>
You can also place <em>point light sources</em> to participate in the Radiosity lighting process.
This is easily achieved with the <a href="/mapping:cawe:editingtools:newlight#the_new_light_tool" class="wikilink1" title="mapping:cawe:editingtools:newlight">New Light tool</a>, whose documentation explains the placement and parameter setup in detail.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Point light sources&quot;,&quot;hid&quot;:&quot;point_light_sources&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;4630-4916&quot;} -->
<h3 class="sectionedit5">Sky Light</h3>
<div class="level3">

<p>
Adding sun- or moonlight to a map works analogously to adding an area light source: Just apply a “sky” material to any surface, and if the material is defined to emit skylight, everything else will happen automatically:
</p>
<ul>
<li class="level1"><div class="li"> The <a href="/mapping:cawe:materialbrowser#the_material_browser" class="wikilink1" title="mapping:cawe:materialbrowser">Material Browser</a> browser informs you whenever a material with “Irradiance” values is selected.</div>
</li>
<li class="level1"><div class="li"> The material definition can be changed according to the Material Systems <a href="/matsys:cmat_manual:keywordreference#keyword_reference" class="wikilink1" title="matsys:cmat_manual:keywordreference">Keyword Reference</a>, see the <code>meta_sunlight</code> keyword.</div>
</li>
<li class="level1"><div class="li"> You may refer to the <a href="/mapping:cawe:yourfirstmap#your_first_map" class="wikilink1" title="mapping:cawe:yourfirstmap">Your First Map</a> tutorial to see an example. It&#039;s actually that easy!</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Sky Light&quot;,&quot;hid&quot;:&quot;sky_light&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;4917-5556&quot;} -->
<h2 class="sectionedit6">Dynamic Lighting</h2>
<div class="level2">

<p>
Dynamic lighting has become popular with the advent of hardware-acceleration for 3D graphics in the recent years.
It is the preferred and most frequently employed lighting technique in most recent commercial graphics software.
</p>

<p>
The essential characteristic of dynamic lighting is that its computational steps occur <em>per-pixel</em> and <em>per-frame</em>.
<em>Per-pixel</em> means that the lighting computations occur on the basis of the output pixels of the rendered primitives (triangles).
<em>Per-frame</em> refers to the fact that all lighting computations occur only at runtime, and in fact, they are performed for each rendered frame anew. This allows both light sources and lit objects to move arbitrarily through the scene, with the lights and shadows being updated correctly and instantaneously.
</p>

<p>
These properties have many implications for the practical use of dynamic lighting:
Dynamic lighting is fast, flexible, dynamic, instantaneous, yields good results and is well supported and accelerated in hardware.
</p>

<p>
Even though dynamic lighting looks not quite as real as the Radiosity method, this is often not a problem, because lighting that looks dramatically good is often preferred over the “boring natural”. Moreover, dynamic lighting avoids the computational complexity that comes with the Radiosity method. Therefore, dynamic lighting is an important component in Cafu.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Dynamic Lighting&quot;,&quot;hid&quot;:&quot;dynamic_lighting&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;5557-6953&quot;} -->
<h3 class="sectionedit7">Point light sources</h3>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Point light sources&quot;,&quot;hid&quot;:&quot;point_light_sources1&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;6954-6983&quot;} -->
<h3 class="sectionedit8">Projective lights</h3>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Projective lights&quot;,&quot;hid&quot;:&quot;projective_lights&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;6984-7011&quot;} -->
<h3 class="sectionedit9">Stencil shadows</h3>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Stencil shadows&quot;,&quot;hid&quot;:&quot;stencil_shadows&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;7012-7037&quot;} -->
<h3 class="sectionedit10">Shadow-Map shadows</h3>
<div class="level3">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Shadow-Map shadows&quot;,&quot;hid&quot;:&quot;shadow-map_shadows&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;7038-7068&quot;} -->
<h2 class="sectionedit11">Spherical Harmonics Lighting</h2>
<div class="level2">

<p>
Lighting with <a href="https://en.wikipedia.org/wiki/Spherical_harmonics" class="interwiki iw_wp" title="https://en.wikipedia.org/wiki/Spherical_harmonics">Spherical Harmonics</a> (“SHL”) is an area of active research in computer science. Its goal is to combine the merits of Radiosity-based lighting with light sources that can move, especially when the light sources are very far away from the scene, like for example the sun or the moon.
</p>

<p>
SHL has been implemented in the scope of my diploma thesis in the Cafu engine, but is currently not supported by the public releases. You may refer to the thesis linked below for more information.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Spherical Harmonics Lighting&quot;,&quot;hid&quot;:&quot;spherical_harmonics_lighting&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;7069-7632&quot;} -->
<h2 class="sectionedit12">See Also</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://www.cafu.de/files/Uni-DA-RealTimeLighting.pdf" class="urlextern" title="http://www.cafu.de/files/Uni-DA-RealTimeLighting.pdf" rel="nofollow">Methods for Real-Time Lighting</a> – Diploma (Masters) Thesis by Carsten Fuchs.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;See Also&quot;,&quot;hid&quot;:&quot;see_also&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:12,&quot;range&quot;:&quot;7633-&quot;} -->